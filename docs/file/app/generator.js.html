<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">app/generator.js | Zeeguu Exercises API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/cookie_handler.js~cookieHandler.html">cookieHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/environment.js~Environment.html">Environment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/feedback.js~Feedback.html">Feedback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/session.js~Session.html">Session</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/the_distraction_shield_extension.js~TDS.html">TDS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/validator.js~Validator.html">Validator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Generator">Generator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-events">events</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">animations</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/animations/loading_animation.js~LoadingAnimation.html">LoadingAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/animations/shake_animation.js~ShakeAnimation.html">ShakeAnimation</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">exercises</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Ex1">Ex1</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Ex2">Ex2</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Ex3">Ex3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Ex4">Ex4</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Exercise">Exercise</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">pages</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EmptyPage">EmptyPage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Home">Home</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NotFound">NotFound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Starter">Starter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">test_example</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/test_example/example.js~Bear.html">Bear</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/generator.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/** Modular Zeeguu Exercise Generator @authors Martin Avagyan, Vlad Turbureanu
 *  @initialize it using: new Generator(args);
 *  @param args is matrix of exercise name and number of bookmarks,
 *         example: [[1,3],[2,4]] 3 bookmarks for ex1 and 4 bookmarks for ex2
 *  @customize it by using prototypal inheritance
 **/

import $ from &apos;jquery&apos;;
import Ex1 from &apos;./exercises/ex1&apos;;
import Ex2 from &apos;./exercises/ex2&apos;;
import Ex3 from &apos;./exercises/ex3&apos;;
import Ex4 from &apos;./exercises/ex4&apos;;
import ProgressBar from &apos;./progress_bar&apos;;
import events from &apos;./pubsub&apos;;
import swal from &apos;sweetalert&apos;;
import Session from &apos;./session&apos;;
import {Loader} from &apos;./loader&apos;;
import Util from &apos;./util&apos;;
import Validator from &apos;./validator&apos;;
import TDS from &apos;./the_distraction_shield_extension&apos;;


 
var Generator = function(set,parentInvocation = &quot;NA&quot;){
    this.init(set,parentInvocation);
};

Generator.prototype = {
    /************************** SETTINGS ********************************/
    data: 0,		//bookmakrs from zeeguu api
    set: 0,			//matrix for initialaizer
    index: 0,		//current index from set
    startTime: new Date(),
    session: Session.getSession()  , //Example of session id 34563456 or 11010001
    templateURL: &apos;static/template/exercise/exercise.html&apos;,
    parentInvocation: &apos;&apos;,

    /**
     *	Saves the common dom in chache
     **/
    cacheDom: function(){
    },

    /**
     * The function caches imports in local scope for later to be referenced as a string
     * */
    cacheExerciseImports: function(){
        this.Ex1 = Ex1;
        this.Ex2 = Ex2;
        this.Ex3 = Ex3;
        this.Ex4 = Ex4;
    },

    /**
     *	Generator initialaizer
     **/
    init: function(set,parentInvocation){
        this.set = set;
        var _this = this;

        this.validator = new Validator(set);

        this.parentInvocation = parentInvocation;
        // &quot;bind&quot; event
        this.$eventFunc = function(){_this.nextEx()};
        events.on(&apos;exerciseCompleted&apos;,this.$eventFunc);

        this.start();
    },

    restart: function(){
        this.start();
    },

    /**
     *	Call to load the data from API
     **/
    start: function ()
    {
        let _this= this;
        //Callback wait until the bookmarks are loaded
        this.validator.getValidBookMarks(function(ldata) {
            _this.data = (ldata);
            _this.set = _this.validator.validSet;
            //Terminate generator if not enough bookmarks
            if(_this.set ==null || _this.set &lt;=0) {
                _this.terminateGenerator();
                return;
            }
            //Loads the HTML general exercise template from static
            $.when(Loader.loadTemplateIntoElem(_this.templateURL,$(&quot;#main-content&quot;))).done(function(){
                // Create the DOM and start the generator
                ProgressBar.init(0, _this.validator.validSize);
                _this.cacheDom();
                _this.cacheExerciseImports();
                _this._constructor();
            });
        });
    },

    filterArray: function(bookmarksData)
    {
        for(var i = 0; i&lt; bookmarksData.length;i++){
            var tempIdx = indexOf(bookmarksData[i]);
            if(tempIdx == -1 || tempIdx == i){
                continue;
            }
            bookmarksData.splice(i, 1);
        }
        return bookmarksData;
    },
    /**
     *	The main constructor
     **/
    _constructor: function (){
        this.index = 0;
        this.startTime = new Date();
        this.nextEx();
    },

    /**
     *	Add Ex here
     **/
    nextEx: function(){
        if(this.index &gt;= this.set.length){
            this.onExSetComplete();
            return;
        }
        var ex = this.set[this.index][0];
        var size = this.set[this.index][1];
        var startingIndex = Util.calcSize(this.set,this.index);

        this.$currentEx = null;
        delete this.$currentEx;
        //Local scope reference
        this.$currentEx = new (this[&apos;Ex&apos;+ex])(this.data,startingIndex,size);
        this.index++;
    },
    /**
     *	Request the submit API
     **/
    submitResults: function(){
        //TODO submit user feedback if any
    },

    /**
     *	When the ex are done perform an action
     **/
    onExSetComplete: function (){
        var _this = this;
        var redirect = TDS.distractionShieldOriginalDestination();
        var finalAction = this.finalActions(redirect,this.parentInvocation);
		_this.submitResults();
        swal({
                title: &quot;You rock!&quot;,
                text: &quot;That took less than &quot;+ Util.calcTimeInMinutes(_this.startTime) + &quot;. practice more?&quot;,
                type: &quot;success&quot;,
                showCancelButton: true,
                confirmButtonColor: &quot;#7eb530&quot;,
                confirmButtonText: &quot;Let&apos;s do it!&quot;,
                cancelButtonText: finalAction.btnText,
                closeOnConfirm: true
            },
            function(isConfirm){
                if(isConfirm){
                    ProgressBar.terminate();
                    _this.restart();
                    return;
                }
                _this.terminateGenerator();
                finalAction.actionFunc();
            });
    },

    /**
     * Text and the action that the secondary button should perform
     * @param {String} redirect url
     * @param {String} parentInvocation, who to emit when the action is done
     * @return {Object}, text of the action and the action function
     * */
    finalActions: function (redirect,parentInvocation) {
        let secondaryBtn = &apos;Go home!&apos;;
        let actionFunction = ()=&gt; {_this.invokeParent();};

        //If the redirect url is present
        if(redirect!=null){
            secondaryBtn = &quot;Take me away!&quot;;
            actionFunction = ()=&gt; { window.location = redirect;};
        }
        //If there is no home available create home
        else if(parentInvocation === &quot;NA&quot;){
            actionFunction = ()=&gt; {
                let redirect = window.location.protocol + &quot;//&quot; + window.location.hostname;
                //Local debuging, wont be part of final code
                window.location.href = (redirect === &quot;http://127.0.0.1&quot;) ? redirect + &quot;:5000&quot; : redirect;
            };
        }
        return {btnText:secondaryBtn, actionFunc:actionFunction};
    },

    terminateGenerator: function(){
        events.off(&apos;exerciseCompleted&apos;,this.$eventFunc);
        ProgressBar.terminate();
        events.emit(&apos;generatorCompleted&apos;);
    },
    invokeParent: function(){
        events.emit(this.parentInvocation);
    },
};

export default Generator;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
